
Port 80 and port 443 appear to be hosting the same web application.

## Todos

- [X] `shared.htb` hostname
- [X] Purpose
- [ ] Backend
	- [ ] PrestaShop
		- [ ] [Reletively recent code execution vulnerability](https://www.bleepingcomputer.com/news/security/hackers-exploited-prestashop-zero-day-to-breach-online-stores/) (no POC)
		- [ ] [PrestaShop session cookie modification vulnerability](https://www.ambionics.io/blog/prestashop-privilege-escalation) (POC)
- [ ] Path discovery
	- [x] `/robots.txt`
	- After restricting 301s, 403s, and 404s:
		- [x] `/api`
			- [x] Any path that matches the pattern `/api*` prompts for HTTP Basic Authentication and returns a 401 if authentication fails
- [x] Virtual host discovery
	- [x] `checkout.shared.htb`
- [x] Authentication
- [x] Input analysis
	- [x] `/index.php?controller=$POTENTIAL_LFI`

## Purpose

The website of Shared Shop, an online clothing store.

## Backend

According to Wappalyzer, the web application leverages Nginx, PHP, Vue.js, and apparently MySQL.

According to `/robots.txt`, the web application may have been generated by [PrestaShop e-commerce open-source solution](https://www.prestashop.com/en).

## Path Discovery

```bash
$ gobuster -u http://shared.htb -w /usr/share/wordlist/
```

### `/robots.txt`

```txt
# robots.txt automatically generated by PrestaShop e-commerce open-source solution
# https://www.prestashop.com - https://www.prestashop.com/forums
# This file is to prevent the crawling and indexing of certain parts
# of your site by web crawlers and spiders run by sites like Yahoo!
# and Google. By telling these "robots" where not to go on your site,
# you save bandwidth and server resources.
# For more information about the robots.txt standard, see:
# https://www.robotstxt.org/robotstxt.html
User-agent: *
# Allow Directives
Allow: */modules/*.css
Allow: */modules/*.js
Allow: */modules/*.png
Allow: */modules/*.jpg
Allow: /js/jquery/*
# Private pages
Disallow: /*?order=
Disallow: /*?tag=
Disallow: /*?id_currency=
Disallow: /*?search_query=
Disallow: /*?back=
Disallow: /*?n=
Disallow: /*&order=
Disallow: /*&tag=
Disallow: /*&id_currency=
Disallow: /*&search_query=
Disallow: /*&back=
Disallow: /*&n=
Disallow: /*controller=addresses
Disallow: /*controller=address
Disallow: /*controller=authentication
Disallow: /*controller=cart
Disallow: /*controller=discount
Disallow: /*controller=footer
Disallow: /*controller=get-file
Disallow: /*controller=header
Disallow: /*controller=history
Disallow: /*controller=identity
Disallow: /*controller=images.inc
Disallow: /*controller=init
Disallow: /*controller=my-account
Disallow: /*controller=order
Disallow: /*controller=order-slip
Disallow: /*controller=order-detail
Disallow: /*controller=order-follow
Disallow: /*controller=order-return
Disallow: /*controller=order-confirmation
Disallow: /*controller=pagination
Disallow: /*controller=password
Disallow: /*controller=pdf-invoice
Disallow: /*controller=pdf-order-return
Disallow: /*controller=pdf-order-slip
Disallow: /*controller=product-sort
Disallow: /*controller=search
Disallow: /*controller=statistics
Disallow: /*controller=attachment
Disallow: /*controller=guest-tracking
# Directories for shared.htb
Disallow: /app/
Disallow: /cache/
Disallow: /classes/
Disallow: /config/
Disallow: /controllers/
Disallow: /download/
Disallow: /js/
Disallow: /localization/
Disallow: /log/
Disallow: /mails/
Disallow: /modules/
Disallow: /override/
Disallow: /pdf/
Disallow: /src/
Disallow: /tools/
Disallow: /translations/
Disallow: /upload/
Disallow: /var/
Disallow: /vendor/
Disallow: /webservice/
Disallow: /en/app/
Disallow: /en/cache/
Disallow: /en/classes/
Disallow: /en/config/
Disallow: /en/controllers/
Disallow: /en/download/
Disallow: /en/js/
Disallow: /en/localization/
Disallow: /en/log/
Disallow: /en/mails/
Disallow: /en/modules/
Disallow: /en/override/
Disallow: /en/pdf/
Disallow: /en/src/
Disallow: /en/tools/
Disallow: /en/translations/
Disallow: /en/upload/
Disallow: /en/var/
Disallow: /en/vendor/
Disallow: /en/webservice/
```

### `/api*`

This appears to belong to the [PrestaShop Webservice API](https://devdocs.prestashop-project.org/8/webservice/), a CRUD API that gives third-party developers the ability to interact with PrestaShop.

Anything that matches this pattern is prompted for HTTP Authentication and failure to authenticate results in a `401`. Authenticating with a bogus username indicates the PrestaShop Webservice is disabled.

## Virtual Host Discovery

```bash
$ gobuster vhost -u http://shared.htb -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-5000.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:          http://shared.htb
[+] Method:       GET
[+] Threads:      10
[+] Wordlist:     /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-5000.txt
[+] User Agent:   gobuster/3.1.0
[+] Timeout:      10s
===============================================================
2022/11/17 14:03:04 Starting gobuster in VHOST enumeration mode
===============================================================
Found: checkout.shared.htb (Status: 200) [Size: 3229]

===============================================================
2022/11/17 14:03:29 Finished
===============================================================
```

## Input Analysis

### `/index.php?controller=$POTENTIAL_LFI`

```php
include("/var/www/html/" . $INPUT . ".php")
```